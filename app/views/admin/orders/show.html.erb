<div class="col-2 offset-2 ">
  <h5 class="offset-2 bg-light">注文履歴詳細</h5>
</div>
<div class="offset-1">
<div class="customer_info offset-1">
  <dl class="row">
    <dt class="col-2">購入者</dt>
    <dd class="col-10 "><%= link_to "#{@order.customer.last_name} #{@order.customer.first_name}", admin_customer_path(@order.customer_id) %></dd>
    <dt class="col-2">注文日</dt>
    <dd class="col-10"><%= @order.created_at.strftime("%Y/%m/%d") %></dd>
    <dt class="col-2">配送先</dt>
    <dd class="col-10">〒<%= @order.postal_code.to_s.insert(3, "-") %>&emsp;<%= @order.address %>
    <p><%= @order.name %></p></dd>
    <dt class="col-2">支払い方法</dt>
    <dd class="col-10"><%= I18n.t(@order.payment_method, scope: ["enums", "order", "payment_method"]) %></dd>
    <dt class="col-2">注文ステータス</dt>
    <dd class="col-2">
      <select>
        <option value="">入金待ち</option>
        <option value="">製作中</option>
        <option value="">発送済み</option>
      </select>
      <%# 12/19 注文ステータス機能は未実装 %>
    </dd>
    <button type="button" class="btn btn-success">更新</button>
  </dl>
</div>
<div class="container" style="margin: 0; padding: 0;">
  <div class="d-flex flex-row">
      <table class="table mx-auto col-9">
        <thead>
          <tr class="table-secondary">
            <th>商品名</th>
            <th scope="col">単価(税込)</th>
            <th scope="col">数量</th>
            <th class="text-break">小計</th>
            <th scope="col" class="text-nowrap">制作ステータス</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          <% @order.order_details.each do |order_detail|%> 
          <tr>
            <td class="text-break"><%= order_detail.item.name %></td>
            <td class="text-break"><%= (order_detail.item.price*1.1).floor.to_s(:delimited) %></td>
            <td class="text-break"><%= order_detail.amount %></td>
            <td class="text-break"><%= (order_detail.item.price*1.1*order_detail.amount).floor.to_s(:delimited) %></td>
            <td>
              <select>
                <option value="">着手不可</option>
                <option value="">製作中</option>
                <option value="">制作完了</option>
              </select>
            </td>
            <%# 12/19 制作ステータス機能は未実装 %>
            <td><button type="button" class="btn btn-success text-nowrap">更新</button></td>
          </tr>
          <%# <% item_price_box << order.items.price*1.1*order.order_details.amount %> 
          <% end %> 
        </tbody>
      </table>
    <div class="right_box col-3 offset-1 d-flex align-items-end">
        <dl class="row">
          <dt class="col-6">商品合計</dt>
          <dd class="col-6 text-right">
            <% total = 0 %>
            <% @order.order_details.each do |order_detail| %>
              <% if order_detail.order_id == @order.id %>
                <% total += (order_detail.item.price*1.1*order_detail.amount).floor %>
              <% end %>
            <% end %>
            <%= total.to_s(:delimited) %>円
          </dd>
          <dt class="col-6">送料</dt>
          <dd class="col-6 text-right"><%= @order.shipping_cost %>円</dd>
          <dt class="col-6">請求金額合計</dt>
          <dd class="col-6 text-right"><%= @order.total_payment.to_s(:delimited) %>円</dd>
        </dl>
    </div>
  </div>
</div>
</div>

